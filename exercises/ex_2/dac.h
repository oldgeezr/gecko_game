#ifndef _DAC_H_
#define _DAC_H_

#include <stdint.h>
#include "efm32gg.h"

#define TABLE_LENGTH 512

void setupDAC(void);
void disableDAC(void);
void setupDMA(void);
void setupPRS(void);

static inline void writeDAC(uint16_t data) 
{
	*DAC0_COMBDATA = data;
}

static inline void playSine(void) 
{
	static uint16_t index = 0;
	writeDAC(sine_wave[index++]);
	if (index == TABLE_LENGTH)
	{
		index = 0;
	}
}

static inline void playSquare(void) 
{
	static uint16_t index = 0;
	if (index == 1)
	{
		writeDAC(0x0ff);
		index = 0;
	} 
	else 
	{
		writeDAC(0x000);
		index++;
	}
}
uint16_t sine_wave[ TABLE_LENGTH ] 
{
	2047,2072,2097,2122,2147,2173,2198,2223,2248,2273,2298,2322,2347,2372,2397,2422,
	2446,2471,2496,2520,2544,2569,2593,2617,2641,2665,2689,2713,2737,2760,2784,2807,
	2830,2854,2877,2899,2922,2945,2967,2990,3012,3034,3056,3078,3099,3121,3142,3163,
	3184,3205,3226,3246,3266,3286,3306,3326,3346,3365,3384,3403,3422,3440,3458,3477,
	3494,3512,3530,3547,3564,3580,3597,3613,3629,3645,3661,3676,3691,3706,3721,3735,
	3749,3763,3776,3790,3803,3816,3828,3840,3852,3864,3875,3887,3897,3908,3918,3928,
	3938,3948,3957,3966,3974,3983,3991,3998,4006,4013,4020,4026,4033,4039,4044,4050,
	4055,4059,4064,4068,4072,4075,4079,4082,4084,4086,4088,4090,4092,4093,4093,4094,
	4094,4094,4093,4093,4092,4090,4088,4086,4084,4082,4079,4075,4072,4068,4064,4059,
	4055,4050,4044,4039,4033,4026,4020,4013,4006,3998,3991,3983,3974,3966,3957,3948,
	3938,3928,3918,3908,3897,3887,3875,3864,3852,3840,3828,3816,3803,3790,3776,3763,
	3749,3735,3721,3706,3691,3676,3661,3645,3629,3613,3597,3580,3564,3547,3530,3512,
	3494,3477,3458,3440,3422,3403,3384,3365,3346,3326,3306,3286,3266,3246,3226,3205,
	3184,3163,3142,3121,3099,3078,3056,3034,3012,2990,2967,2945,2922,2899,2877,2854,
	2830,2807,2784,2760,2737,2713,2689,2665,2641,2617,2593,2569,2544,2520,2496,2471,
	2446,2422,2397,2372,2347,2322,2298,2273,2248,2223,2198,2173,2147,2122,2097,2072,
	2047,2022,1997,1972,1947,1921,1896,1871,1846,1821,1796,1772,1747,1722,1697,1672,
	1648,1623,1598,1574,1550,1525,1501,1477,1453,1429,1405,1381,1357,1334,1310,1287,
	1264,1240,1217,1195,1172,1149,1127,1104,1082,1060,1038,1016,995,973,952,931,
	910,889,868,848,828,808,788,768,748,729,710,691,672,654,636,617,
	600,582,564,547,530,514,497,481,465,449,433,418,403,388,373,359,
	345,331,318,304,291,278,266,254,242,230,219,207,197,186,176,166,
	156,146,137,128,120,111,103,96,88,81,74,68,61,55,50,44,
	39,35,30,26,22,19,15,12,10,8,6,4,2,1,1,0,
	0,0,1,1,2,4,6,8,10,12,15,19,22,26,30,35,
	39,44,50,55,61,68,74,81,88,96,103,111,120,128,137,146,
	156,166,176,186,197,207,219,230,242,254,266,278,291,304,318,331,
	345,359,373,388,403,418,433,449,465,481,497,514,530,547,564,582,
	600,617,636,654,672,691,710,729,748,768,788,808,828,848,868,889,
	910,931,952,973,995,1016,1038,1060,1082,1104,1127,1149,1172,1195,1217,1240,
	1264,1287,1310,1334,1357,1381,1405,1429,1453,1477,1501,1525,1550,1574,1598,1623,
	1648,1672,1697,1722,1747,1772,1796,1821,1846,1871,1896,1921,1947,1972,1997,2022,
};

#endif